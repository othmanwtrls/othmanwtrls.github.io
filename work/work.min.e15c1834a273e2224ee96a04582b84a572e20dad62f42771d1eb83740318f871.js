(function(){const r=document.getElementById("work-data");if(!r)return;const i=JSON.parse(r.textContent||"[]"),a=document.getElementById("grid"),e=document.getElementById("roleFilter"),n=document.getElementById("techList"),t=document.getElementById("search"),j=document.getElementById("clearBtn"),g=document.getElementById("count"),m=document.getElementById("noResults"),d=Array.from(new Set(i.flatMap(e=>e.technos))).sort((e,t)=>e.localeCompare(t)),l=Array.from(new Set(i.flatMap(e=>e.roles))).sort((e,t)=>e.localeCompare(t));function u(){const t=document.createDocumentFragment();l.forEach(e=>{const n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)}),e.appendChild(t)}function h(){n.innerHTML="",d.forEach(e=>{const t=document.createElement("label");t.className="chip",t.innerHTML=`<input type="checkbox" value="${e}"><span>${e}</span>`,n.appendChild(t)})}function c(){return Array.from(n.querySelectorAll('input[type="checkbox"]:checked')).map(e=>e.value)}function f(n){const s=e.value,o=c(),i=(t.value||"").trim().toLowerCase();if(s&&!n.roles.includes(s))return!1;if(o.length&&!o.every(e=>n.technos.includes(e)))return!1;if(i){const e=`${n.titre} ${n.resume} ${n.roles.join(" ")} ${n.technos.join(" ")}`.toLowerCase();if(!e.includes(i))return!1}return!0}function p(e){const t=e.roles.map(e=>`<span class="tag tag-role" style="border:1px solid #64b5f6; border-radius:999px;">${e}</span>`).join(""),n=e.technos.map(e=>`<span class="tag tag-tech" style="border:1px solid #81c784; border-radius:999px;">${e}</span>`).join("");return`
      <a class="work-card" href="${e.url}">
        <div style="padding:1rem">
          <h3 style="margin:.2rem 0 .4rem 0">${e.titre}</h3>
          <div class="meta" style="opacity:.8; font-size:.9em; display:flex; flex-wrap:wrap; gap:.5rem 1rem;">
            <span>ðŸ“… ${e.periode}</span>
          </div>
          ${e.resume?`<p style="margin:.6rem 0">${e.resume}</p>`:``}
          <div class="tag-row" style="margin-top:.5rem; gap:.4rem;">
            ${t} ${n}
          </div>
        </div>
      </a>`}function s(){const e=i.filter(f);a.setAttribute("aria-busy","true"),a.innerHTML=e.map(p).join(""),a.setAttribute("aria-busy","false"),g.textContent=`${e.length} result${e.length>1?"s":""}`,m.style.display=e.length?"none":"block"}function v(){e.value="",t.value="",n.querySelectorAll('input[type="checkbox"]').forEach(e=>e.checked=!1),s(),o()}function b(){const s=new URLSearchParams(location.search),o=s.get("role"),i=s.get("tech"),a=s.get("q");if(o&&(e.value=o),a&&(t.value=a),i){const e=new Set(i.split(",").map(e=>e.trim()));n.querySelectorAll('input[type="checkbox"]').forEach(t=>t.checked=e.has(t.value))}}function o(){const n=new URLSearchParams;e.value&&n.set("role",e.value);const s=c();s.length&&n.set("tech",s.join(","));const o=t.value.trim();o&&n.set("q",o);const i=n.toString();history.replaceState(null,"",i?`?${i}`:location.pathname)}u(),h(),b(),s(),e.addEventListener("change",()=>{s(),o()}),n.addEventListener("change",()=>{s(),o()}),t.addEventListener("input",()=>{clearTimeout(t._t),t._t=setTimeout(()=>{s(),o()},120)}),j.addEventListener("click",v)})()